<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../css/style.css" type="text/css">


        <title>Start Page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>
    <body>
        <h1>Klantenlijst</h1>
        <br/>
        <h2>Alle klanten in database</h2>
        <br/>
        <table id="klanten">
            <thead id="klantenTitle">
            </thead>
            <tbody id="klantenBody">
            </tbody>
        </table>
        <br/>
        <h2>Voeg nieuw klant toe</h2>
        <br/>
        <form id="nieuwKlant" method="post">
            <table>
                <tr>
                    <td>Voornaam</td>
                    <td><input type="text" size="40" id="voornaam"/></td>
                </tr><tr>
                    <td>Tussenvoegsel</td>
                    <td><input type="text" id="tussenvoegsel" size="10"/></td>
                </tr><tr>
                    <td>Achternaam</td>
                    <td><input type="text" size="40" id="achternaam"/></td>
                </tr><tr>
                    <td>E-mail</td>
                    <td><input type="text" size="80" id="email"/></td>
                </tr><tr>
                    <td></td><td>
                        <input type="submit" value="Voeg artikel toe"/></td>
                </tr>
            </table>
        </form>
        <p id="error"></p>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.js"></script>
        <script>
            $(document).ready(function(){
                var restURL = "http://localhost:8080/RestTest/rest/klant";
                $.getJSON(restURL, function(result){
                    $.each(result, function(i, field){
                        $("#klantenBody").append("<tr>");
                        for (var p in field){
                            if(i===0){
                                $("#klantenTitle").append("<th>" + p + "</th>");
                            }
                            $("#klantenBody").append("<td>" + field[p] + "</td>");
                        }
                        if(i===0){
                            $("#klantenTitle").append("<th colspan=2>Actie</th>")
                        }
                        $("#klantenBody").append('<td><input type="button" id="editKlant" value="Bewerken"/></td>');
                        $("#klantenBody").append('<td><input type="button" class="delete" id="'+ field.idKlant + '" value="Verwijderen"/></td>');
                        $("#klantenBody").append("</tr>");
                    });
                });
                
                $("#nieuwKlant").submit(function(){
                    $.post(restURL, formToJson(), alert(formToJson()));
                });
                function formToJson(){
                    return JSON.stringify({
                        "achternaam": $("#achternaam").val(),
                        "email": $("#email").val(),
                        "tussenvoegsel": $("#tussenvoegsel").val(),
                        "voornaam": $("#voornaam").val()
                    });
                }
                $(".delete").click(function(){
                    alert('Klant delete called');
                    $.ajax({
                        type: 'DELETE',
                        url: restURL + "/" + event.target.id,
                        success: function(data, textStatus, jqXHR){
                            alert('Klant deleted successfully');
                        },
                        error: function(jqXHR, textStatus, errorThrown){
                            alert('Error when deleting klant');
                        }
                    });
                });
            });
        </script>
    </body>
</html>
